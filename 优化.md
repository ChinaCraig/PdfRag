1.升级检索框架为“分层召回 + 交叉重排”
① BM25 粗召回 Top-200；② 向量召回 Top-200；③ 合并去重；④ Mini-LM 或 bge-reranker 重排 Top-k；⑤ 阈值过滤
2.语义切块 + 层级标签
用 [TextSplitter-Hierarchy] (or LangChain RecursiveCharacterTextSplitter with add_start_index)：保持标题→段落→句子层级；切块元数据携带 section_title、page、parent_id。
3.NER / LLM 实体抽取 替换 _extract_query_entities & 图谱实体对齐
• 使用 spacy-zh/ja/en + custom patterns
• 或调用 LLM few-shot prompt （保留缓存）
4.表格/图像结构化嵌入
• 表格 → JSON (行列、标题) + table-text encoder (TaBERT/Tapas-emb)
• 图片 → BLIP-2 caption + 标签 + OCR 合并
统一发送到同一嵌入模型或多向量字段
5.结果融合策略可配置
使用 RRF（Reciprocal Rank Fusion）或训练 LightGBM ranker，特征含：来源（vector/graph）、score、chunk_type、chunk_len、page_distance。
6.异步 & GPU 批处理
• GPU 并行化 embeddings(>512 tokens 自动切片)
• Celery/Arq 后台任务
• FastAPI + async Milvus/Neo4j client
7.监控 + 指标
Prometheus 收集 QPS、avg latency、Milvus / Neo4j error rate；Grafana 报警